{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _defineProperty2 = require('babel-runtime/helpers/defineProperty');\n\nvar _defineProperty3 = _interopRequireDefault(_defineProperty2);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _classnames4 = require('classnames');\n\nvar _classnames5 = _interopRequireDefault(_classnames4);\n\nvar _react = require('react');\n\nvar React = _interopRequireWildcard(_react);\n\nvar _propTypes = require('prop-types');\n\nvar PropTypes = _interopRequireWildcard(_propTypes);\n\nvar _rmcFeedback = require('rmc-feedback');\n\nvar _rmcFeedback2 = _interopRequireDefault(_rmcFeedback);\n\nvar _getDataAttr = require('../_util/getDataAttr');\n\nvar _getDataAttr2 = _interopRequireDefault(_getDataAttr);\n\nvar _getLocale = require('../_util/getLocale');\n\nvar _PropsType = require('./PropsType');\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj['default'] = obj;\n    return newObj;\n  }\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    'default': obj\n  };\n}\n\nfunction onNextFrame(cb) {\n  if (window.requestAnimationFrame) {\n    return window.requestAnimationFrame(cb);\n  }\n\n  return window.setTimeout(cb, 1);\n}\n\nfunction clearNextFrameAction(nextFrameId) {\n  if (window.cancelAnimationFrame) {\n    window.cancelAnimationFrame(nextFrameId);\n  } else {\n    window.clearTimeout(nextFrameId);\n  }\n}\n\nvar SearchBar = function (_React$Component) {\n  (0, _inherits3['default'])(SearchBar, _React$Component);\n\n  function SearchBar(props) {\n    (0, _classCallCheck3['default'])(this, SearchBar);\n\n    var _this = (0, _possibleConstructorReturn3['default'])(this, (SearchBar.__proto__ || Object.getPrototypeOf(SearchBar)).call(this, props));\n\n    _this.onSubmit = function (e) {\n      e.preventDefault();\n\n      if (_this.props.onSubmit) {\n        _this.props.onSubmit(_this.state.value || '');\n      }\n\n      if (_this.inputRef) {\n        _this.inputRef.blur();\n      }\n    };\n\n    _this.onChange = function (e) {\n      if (!_this.state.focus) {\n        _this.setState({\n          focus: true\n        });\n      }\n\n      var value = e.target.value;\n\n      if (!('value' in _this.props)) {\n        _this.setState({\n          value: value\n        });\n      }\n\n      if (_this.props.onChange) {\n        _this.props.onChange(value);\n      }\n    };\n\n    _this.onFocus = function () {\n      _this.setState({\n        focus: true\n      });\n\n      _this.firstFocus = true;\n\n      if (_this.props.onFocus) {\n        _this.props.onFocus();\n      }\n    };\n\n    _this.onBlur = function () {\n      _this.onBlurTimeout = onNextFrame(function () {\n        if (!_this.blurFromOnClear) {\n          if (document.activeElement !== _this.inputRef) {\n            _this.setState({\n              focus: false\n            });\n          }\n        }\n\n        _this.blurFromOnClear = false;\n      });\n\n      if (_this.props.onBlur) {\n        // fix autoFocus item blur with flash\n        setTimeout(function () {\n          // fix ios12 wechat browser click failure after input\n          if (document.body) {\n            document.body.scrollTop = document.body.scrollTop;\n          }\n        }, 100);\n\n        _this.props.onBlur();\n      }\n    };\n\n    _this.onClear = function () {\n      _this.doClear();\n    };\n\n    _this.doClear = function () {\n      var blurFromOnClear = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      _this.blurFromOnClear = blurFromOnClear;\n\n      if (!('value' in _this.props)) {\n        _this.setState({\n          value: ''\n        });\n      }\n\n      if (_this.props.onClear) {\n        _this.props.onClear('');\n      }\n\n      if (_this.props.onChange) {\n        _this.props.onChange('');\n      }\n\n      if (blurFromOnClear) {\n        _this.focus();\n      }\n    };\n\n    _this.onCancel = function () {\n      if (_this.props.onCancel) {\n        _this.props.onCancel(_this.state.value || '');\n      } else {\n        _this.doClear(false);\n      }\n    };\n\n    _this.focus = function () {\n      if (_this.inputRef) {\n        _this.inputRef.focus();\n      }\n    };\n\n    var value = void 0;\n\n    if ('value' in props) {\n      value = props.value || '';\n    } else if ('defaultValue' in props) {\n      value = props.defaultValue;\n    } else {\n      value = '';\n    }\n\n    _this.state = {\n      value: value,\n      focus: false\n    };\n    return _this;\n  }\n\n  (0, _createClass3['default'])(SearchBar, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      if (this.rightBtnRef) {\n        var initBtn = window.getComputedStyle(this.rightBtnRef);\n        this.rightBtnInitMarginleft = initBtn.marginLeft;\n      }\n\n      this.componentDidUpdate();\n    }\n  }, {\n    key: 'componentDidUpdate',\n    value: function componentDidUpdate() {\n      if (this.syntheticPhRef) {\n        if (this.inputContainerRef && this.inputContainerRef.className.indexOf(this.props.prefixCls + '-start') > -1) {\n          // 检测是否包含名为 ${this.props.prefixCls}-start 样式，生成动画\n          // offsetWidth 某些时候是向上取整，某些时候是向下取整，不能用\n          if (this.syntheticPhContainerRef) {\n            var realWidth = this.syntheticPhContainerRef.getBoundingClientRect().width; // 包含小数\n\n            this.syntheticPhRef.style.width = Math.ceil(realWidth) + 'px';\n          }\n\n          if (!this.props.showCancelButton && this.rightBtnRef) {\n            this.rightBtnRef.style.marginRight = '0';\n          }\n        } else {\n          this.syntheticPhRef.style.width = '100%';\n\n          if (!this.props.showCancelButton && this.rightBtnRef) {\n            this.rightBtnRef.style.marginRight = '-' + (this.rightBtnRef.offsetWidth + (this.rightBtnInitMarginleft != null ? parseInt(this.rightBtnInitMarginleft, 10) : 0)) + 'px';\n          }\n        }\n      }\n    }\n  }, {\n    key: 'componentWillReceiveProps',\n    value: function componentWillReceiveProps(nextProps) {\n      if ('value' in nextProps && nextProps.value !== this.state.value) {\n        this.setState({\n          value: nextProps.value\n        });\n      }\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      if (this.onBlurTimeout) {\n        clearNextFrameAction(this.onBlurTimeout);\n        this.onBlurTimeout = null;\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _classnames3,\n          _this2 = this;\n\n      var _props = this.props,\n          prefixCls = _props.prefixCls,\n          showCancelButton = _props.showCancelButton,\n          disabled = _props.disabled,\n          placeholder = _props.placeholder,\n          className = _props.className,\n          style = _props.style,\n          maxLength = _props.maxLength; // tslint:disable-next-line:variable-name\n\n      var _locale = (0, _getLocale.getComponentLocale)(this.props, this.context, 'SearchBar', function () {\n        return require('./locale/zh_CN');\n      });\n\n      var cancelText = _locale.cancelText;\n      var _state = this.state,\n          value = _state.value,\n          focus = _state.focus;\n      var wrapCls = (0, _classnames5['default'])(prefixCls, className, (0, _defineProperty3['default'])({}, prefixCls + '-start', !!(focus || value && value.length > 0)));\n      var clearCls = (0, _classnames5['default'])(prefixCls + '-clear', (0, _defineProperty3['default'])({}, prefixCls + '-clear-show', !!(focus && value && value.length > 0)));\n      var cancelCls = (0, _classnames5['default'])(prefixCls + '-cancel', (_classnames3 = {}, (0, _defineProperty3['default'])(_classnames3, prefixCls + '-cancel-show', !!(showCancelButton || focus || value && value.length > 0)), (0, _defineProperty3['default'])(_classnames3, prefixCls + '-cancel-anim', this.firstFocus), _classnames3));\n      return React.createElement('form', {\n        onSubmit: this.onSubmit,\n        className: wrapCls,\n        style: style,\n        ref: function ref(el) {\n          return _this2.inputContainerRef = el;\n        },\n        action: '#'\n      }, React.createElement('div', {\n        className: prefixCls + '-input'\n      }, React.createElement('div', {\n        className: prefixCls + '-synthetic-ph',\n        ref: function ref(el) {\n          return _this2.syntheticPhRef = el;\n        }\n      }, React.createElement('span', {\n        className: prefixCls + '-synthetic-ph-container',\n        ref: function ref(el) {\n          return _this2.syntheticPhContainerRef = el;\n        }\n      }, React.createElement('i', {\n        className: prefixCls + '-synthetic-ph-icon'\n      }), React.createElement('span', {\n        className: prefixCls + '-synthetic-ph-placeholder' // tslint:disable-next-line:jsx-no-multiline-js\n        ,\n        style: {\n          visibility: placeholder && !value ? 'visible' : 'hidden'\n        }\n      }, placeholder))), React.createElement('input', (0, _extends3['default'])({\n        type: 'search',\n        className: prefixCls + '-value',\n        value: value,\n        disabled: disabled,\n        placeholder: placeholder,\n        onChange: this.onChange,\n        onFocus: this.onFocus,\n        onBlur: this.onBlur,\n        ref: function ref(el) {\n          return _this2.inputRef = el;\n        },\n        maxLength: maxLength\n      }, (0, _getDataAttr2['default'])(this.props))), React.createElement(_rmcFeedback2['default'], {\n        activeClassName: prefixCls + '-clear-active'\n      }, React.createElement('a', {\n        onClick: this.onClear,\n        className: clearCls\n      }))), React.createElement('div', {\n        className: cancelCls,\n        onClick: this.onCancel,\n        ref: function ref(el) {\n          return _this2.rightBtnRef = el;\n        }\n      }, this.props.cancelText || cancelText));\n    }\n  }]);\n  return SearchBar;\n}(React.Component);\n\nexports['default'] = SearchBar;\nSearchBar.defaultProps = _PropsType.defaultProps;\nSearchBar.contextTypes = {\n  antLocale: PropTypes.object\n};\nmodule.exports = exports['default'];","map":null,"metadata":{},"sourceType":"script"}